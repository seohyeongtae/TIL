DROP SEQUENCE ITEM_SEQUENCE;
DROP SEQUENCE USERITEM_SEQ;

DROP TABLE USER_ITEM;
DROP TABLE GAME_USER;
DROP TABLE GAME_ITEM;

CREATE TABLE GAME_USER(
ID VARCHAR2(10),
PWD VARCHAR2(20),
NAME VARCHAR2(30)
);
ALTER TABLE GAME_USER ADD CONSTRAINT user_pk PRIMARY KEY (ID);
ALTER TABLE GAME_USER ADD CONSTRAINT user_pwd_nn CHECK(PWD IS NOT NULL);
ALTER TABLE GAME_USER ADD CONSTRAINT user_pwd_check CHECK(LENGTH(PWD) > 3);
ALTER TABLE GAME_USER ADD CONSTRAINT user_name_nn CHECK(NAME IS NOT NULL);


CREATE SEQUENCE ITEM_SEQUENCE
 START WITH 100
  INCREMENT BY 1;

CREATE TABLE GAME_ITEM(
ID NUMBER(10),
NAME VARCHAR2(30),
PRICE NUMBER(20)
);
ALTER TABLE GAME_ITEM ADD CONSTRAINT item_pk PRIMARY KEY (ID);
ALTER TABLE GAME_ITEM ADD CONSTRAINT item_un UNIQUE (NAME);
ALTER TABLE GAME_ITEM ADD REGDATE DATE;
ALTER TABLE GAME_ITEM MODIFY PRICE DEFAULT 10000;
COMMIT;

INSERT INTO GAME_USER VALUES('id01','pwd01','이말숙');
INSERT INTO GAME_USER VALUES('id02','pwd02','김말숙');
INSERT INTO GAME_USER VALUES('id03','pwd03','황말숙');
COMMIT;

INSERT INTO GAME_ITEM VALUES(ITEM_SEQUENCE.NEXTVAL,'칼',10000,SYSDATE);
INSERT INTO GAME_ITEM VALUES(ITEM_SEQUENCE.NEXTVAL,'총',20000,SYSDATE);
INSERT INTO GAME_ITEM VALUES(ITEM_SEQUENCE.NEXTVAL,'차',30000,SYSDATE);
COMMIT;

SELECT * FROM GAME_USER;
SELECT * FROM GAME_ITEM;


CREATE SEQUENCE USERITEM_SEQ
START WITH 1000
INCREMENT BY 1;

CREATE TABLE USER_ITEM(
ID VARCHAR2(20),
USER_ID VARCHAR2(10),
ITEM_ID NUMBER(10),
QT NUMBER(10)
);
ALTER TABLE USER_ITEM ADD CONSTRAINT ui_pk PRIMARY KEY (ID);
ALTER TABLE USER_ITEM ADD CONSTRAINT ui_fk1 FOREIGN KEY (USER_ID) REFERENCES GAME_USER(ID);
ALTER TABLE USER_ITEM ADD CONSTRAINT ui_fk2 FOREIGN KEY (ITEM_ID) REFERENCES GAME_ITEM(ID);
ALTER TABLE USER_ITEM MODIFY QT DEFAULT 1;

INSERT INTO USER_ITEM VALUES (TO_CHAR(SYSDATE,'YYYYMMDD')|| USERITEM_SEQ.NEXTVAL,'id01',100,3);
INSERT INTO USER_ITEM (ID,USER_ID,ITEM_ID) VALUES (TO_CHAR(SYSDATE,'YYYYMMDD')|| USERITEM_SEQ.NEXTVAL,'id01',101);
COMMIT;

SELECT * FROM USER_ITEM;



ALTER TABLE USER_ITEM DISABLE CONSTRAINT ui_fk1;
ALTER TABLE USER_ITEM DISABLE CONSTRAINT ui_fk2;

DELETE FROM GAME_USER WHERE ID='id01';